document.addEventListener("DOMContentLoaded",function(){const i=[document.getElementById("company-search"),document.getElementById("company-search-mobile")],o=[document.getElementById("search-results"),document.getElementById("search-results-mobile")];document.getElementById("search-button"),document.getElementById("search-button-mobile");let l,a={};i.forEach((t,e)=>{t&&t.addEventListener("input",function(){clearTimeout(l),l=setTimeout(()=>{const r=this.value.trim();r.length>1?m(r,e):(o[e].innerHTML="",o[e].classList.add("hidden"))},500)})});function m(t,e){if(a[t]){d(a[t],e);return}const r=`/api/company-search?query=${encodeURIComponent(t)}`;u(e),fetch(r).then(n=>{if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);return n.json()}).then(n=>{if(console.log("API Response:",n),n.errors)throw new Error(n.errors);let c=[];n["hojin-infos"]&&Array.isArray(n["hojin-infos"])&&(c=n["hojin-infos"].map(s=>({company_name:s.name,location:s.location,corporate_number:s.corporate_number}))),a[t]=c,d(c,e)}).catch(n=>{console.error("Error:",n),o[e].innerHTML='<p class="p-2 text-red-500">検索中にエラーが発生しました。: '+n.message+"</p>",o[e].classList.remove("hidden")}).finally(()=>{h(e)})}function d(t,e){if(o[e].innerHTML="",t.length===0)o[e].innerHTML='<p class="p-2">検索結果がありません。</p>';else{const r=document.createElement("p");r.className="p-2 text-sm text-gray-600",r.textContent=`${t.length}件の結果`,o[e].appendChild(r);const n=document.createElement("ul");n.className="divide-y divide-gray-200",t.forEach(c=>{const s=document.createElement("li");s.className="p-1 hover:bg-gray-100 cursor-pointer transition duration-150 ease-in-out",s.innerHTML=`
                    <div class="text-sm font-medium text-gray-800">${c.company_name}</div>
                    <div class="text-xs text-gray-500">${c.location}</div>
                `,s.addEventListener("click",()=>{window.location.href=`${window.appUrl}/companies/${c.corporate_number}`}),n.appendChild(s)}),o[e].appendChild(n)}o[e].classList.remove("hidden")}function u(t){const e=document.createElement("div");e.id=`search-loader-${t}`,e.className="text-center p-3",e.innerHTML='<div class="inline-block animate-spin rounded-full h-6 w-6 border-t-2 border-b-2 border-cyan-500"></div>',o[t].innerHTML="",o[t].appendChild(e),o[t].classList.remove("hidden")}function h(t){const e=document.getElementById(`search-loader-${t}`);e&&e.remove()}document.addEventListener("click",function(t){o.forEach((e,r)=>{!e.contains(t.target)&&t.target!==i[r]&&e.classList.add("hidden")})})});
