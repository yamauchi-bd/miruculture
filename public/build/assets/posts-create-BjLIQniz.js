document.addEventListener("DOMContentLoaded",function(){console.log("DOMContentLoaded event fired"),h(),v(),B(),_(),C(),q();for(let e=1;e<=3;e++){const n=document.getElementById(`factor_${e}_detail`),t=document.getElementById(`factor_${e}_detail_count`),r=document.getElementById(`factor_${e}_satisfaction_reason`),c=document.getElementById(`factor_${e}_satisfaction_reason_count`);n&&t&&n.addEventListener("input",function(){t.textContent=this.value.length}),r&&c&&r.addEventListener("input",function(){c.textContent=this.value.length})}});function h(){const e=document.getElementById("job-categories");if(!e){console.error("job-categories element not found");return}const n=JSON.parse(e.dataset.categories),t=document.getElementById("job_category");if(!t){console.error("job_category element not found");return}t.addEventListener("change",function(){E(this.value,n)})}function E(e,n){const t=document.getElementById("job_subcategory");t.innerHTML='<option value="">選択してください</option>',e&&n[e]&&n[e].forEach(r=>{const c=document.createElement("option");c.value=r.id,c.textContent=r.name,t.appendChild(c)})}function v(){for(let e=2;e<=3;e++)b(e);L(),S(),I()}function b(e){const n=document.querySelectorAll(`input[name="deciding_factor_${e}"]`),t=document.getElementById(`factor_${e}_detail`),r=document.querySelectorAll(`input[name="factor_${e}_satisfaction"]`),c=document.getElementById(`factor_${e}_satisfaction_reason`);n.forEach(s=>{s.addEventListener("change",function(){const o=document.querySelector(`input[name="deciding_factor_${e}"]:checked`)!==null;console.log(`Factor ${e} selected: ${o}`),t.required=o,r.forEach(a=>a.required=o),c.required=o})})}function L(){document.querySelectorAll(".deciding-factor").forEach(n=>{n.addEventListener("change",function(){if(document.querySelectorAll(`[name="${this.name}"] + .factor-label`).forEach(t=>{t.classList.remove("bg-cyan-500","text-white","border-cyan-500"),t.classList.add("bg-white","hover:bg-gray-100","text-gray-700","border-gray-300")}),this.checked){const t=this.nextElementSibling;t.classList.remove("bg-white","hover:bg-gray-100","text-gray-700","border-gray-300"),t.classList.add("bg-cyan-500","text-white","border-cyan-500")}})})}function S(){const e=document.getElementById("add-factor-button"),n=document.querySelectorAll("#deciding-factors > div");let t=1;e.addEventListener("click",function(){t<3&&(t++,n[t-1].classList.remove("hidden"),t===3&&(e.style.display="none"))})}function I(){const e=document.querySelectorAll(".deciding-factor"),n={};e.forEach(r=>{const c=r.getAttribute("name");n[c]||(n[c]=[]),n[c].push(r)});function t(){const r=new Set;Object.values(n).forEach(c=>{c.forEach(s=>{s.checked&&r.add(s.value)})}),Object.values(n).forEach(c=>{c.forEach(s=>{const o=s.nextElementSibling;r.has(s.value)&&!s.checked?(s.disabled=!0,o.classList.add("opacity-50","cursor-not-allowed")):(s.disabled=!1,o.classList.remove("opacity-50","cursor-not-allowed"))})})}e.forEach(r=>{r.addEventListener("change",t)}),t()}function B(){document.querySelectorAll(".flex.items-center").forEach(n=>{const t=n.querySelectorAll("svg"),r=n.querySelectorAll('input[type="radio"]');function c(o){t.forEach((a,l)=>{l<=o?(a.classList.add("text-cyan-500"),a.classList.remove("text-gray-300")):(a.classList.remove("text-cyan-500"),a.classList.add("text-gray-300"))})}r.forEach((o,a)=>{o.addEventListener("change",()=>{c(a)})}),t.forEach((o,a)=>{o.addEventListener("mouseover",()=>{c(a)}),o.addEventListener("mouseout",()=>{const l=n.querySelector('input[type="radio"]:checked');c(l?Array.from(r).indexOf(l):-1)}),o.addEventListener("click",()=>{r[a].checked=!0,c(a)})});const s=n.querySelector('input[type="radio"]:checked');s&&c(Array.from(r).indexOf(s))})}function _(){const e=document.getElementById("next-button"),n=document.getElementById("back-button");document.getElementById("submit-button");const t=document.getElementById("section-1"),r=document.getElementById("section-2"),c=document.getElementById("progress-bar"),s=document.getElementById("progress-bar-2"),o=document.getElementById("step-2");e.addEventListener("click",function(l){l.preventDefault(),a()?(t.classList.add("hidden"),r.classList.remove("hidden"),c.style.width="100%",s.style.width="30%",o.classList.remove("bg-white","border-2","border-gray-300"),o.classList.add("bg-cyan-500"),o.querySelector("span").classList.remove("text-gray-500"),o.querySelector("span").classList.add("text-white"),window.scrollTo({top:0,behavior:"smooth"})):console.log("フォームのバリデーションに失敗しました")}),n.addEventListener("click",function(){r.classList.add("hidden"),t.classList.remove("hidden"),c.style.width="30%",s.style.width="0%",o.classList.add("bg-white","border-2","border-gray-300"),o.classList.remove("bg-cyan-500"),o.querySelector("span").classList.add("text-gray-500"),o.querySelector("span").classList.remove("text-white")});function a(){const l=t.querySelectorAll("input[required], select[required], textarea[required]");let f=!0;l.forEach(u=>{let d;if(u.type==="radio"){d=document.getElementById(`${u.name}-error`);const g=t.querySelectorAll(`input[name="${u.name}"]`);Array.from(g).some(p=>p.checked)?(g.forEach(p=>p.classList.remove("error")),d&&(d.style.display="none")):(f=!1,g.forEach(p=>p.classList.add("error")),d&&(d.textContent="このフィールドは必須です。",d.style.display="block"))}else u.type==="select-one"?(d=document.getElementById(`${u.id}-error`),u.value===""?(f=!1,u.classList.add("error"),d&&(d.textContent="このフィールドは必須です。",d.style.display="block")):(u.classList.remove("error"),d&&(d.style.display="none"))):u.value.trim()?(u.classList.remove("error"),d&&(d.style.display="none")):(d=document.getElementById(`${u.id}-error`),f=!1,u.classList.add("error"),d&&(d.textContent="このフィールドは必須です。",d.style.display="block"))});const i=document.querySelector('input[name="status"]:checked'),y=document.getElementById("end_year"),m=document.getElementById("end_year-error");return i&&i.value==="退職済み"&&(!y.value||y.value==="")?(f=!1,y.classList.add("error"),m&&(m.textContent="退職年を選択してください。",m.style.display="block")):(y.classList.remove("error"),m&&(m.style.display="none")),f}}function C(){const e=document.querySelectorAll('input[name="status"]'),n=document.getElementById("start_year"),t=document.getElementById("end_year");n.addEventListener("change",function(){r()});function r(){const s=parseInt(n.value),o=new Date().getFullYear();t.innerHTML='<option value="" selected disabled>退職年</option>';for(let a=s;a<=o;a++){const l=document.createElement("option");l.value=a,l.textContent=a+"年",t.appendChild(l)}c()}function c(){var l;const s=document.getElementById("end_year");if(!s)return;const o=((l=document.querySelector('input[name="status"]:checked'))==null?void 0:l.value)==="在籍中";s.style.display=o?"none":"inline-block",s.disabled=o,s.required=!o,o&&(s.value="");const a=document.getElementById("end_year-error");a&&(a.style.display="none")}e.forEach(s=>{s.addEventListener("change",c)}),r(),c()}function q(){const e=document.getElementById("company-input"),n=document.getElementById("input-results"),t=document.getElementById("input-button"),r=document.getElementById("company_name"),c=document.getElementById("corporate_number");let s;e.addEventListener("input",o),t.addEventListener("click",a),document.addEventListener("click",function(i){!e.contains(i.target)&&!n.contains(i.target)&&n.classList.add("hidden")});function o(){clearTimeout(s),s=setTimeout(()=>{const i=this.value.trim();i.length>=2?a(i):n.classList.add("hidden")},300)}function a(i){typeof i!="string"&&(i=e.value.trim()),i.length>=2&&fetch(`/api/companies/search?term=${encodeURIComponent(i)}`).then(y=>y.json()).then(l)}function l(i){n.innerHTML="",i.forEach(y=>{const m=document.createElement("div");m.textContent=y.company_name,m.classList.add("p-2","hover:bg-gray-100","cursor-pointer"),m.addEventListener("click",()=>f(y)),n.appendChild(m)}),n.classList.remove("hidden")}function f(i){e.value=i.company_name,r.value=i.company_name,c.value=i.corporate_number,n.classList.add("hidden"),e.setAttribute("readonly",!0),t.setAttribute("disabled",!0)}}
