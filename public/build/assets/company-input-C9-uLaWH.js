document.addEventListener("DOMContentLoaded",function(){const a=document.getElementById("company-input"),t=document.getElementById("input-results"),o=document.getElementById("corporate_number"),i=document.getElementById("company_name"),m=document.getElementById("input-button");let s=null;const d=new URLSearchParams(window.location.search).get("corporate_number");d&&fetch(`/api/companies/${d}`).then(e=>e.json()).then(e=>{a.value=e.company_name,i.value=e.company_name,o.value=e.corporate_number}).catch(e=>console.error("Error:",e)),a.addEventListener("input",function(){s!==null&&clearTimeout(s),s=setTimeout(()=>{const e=this.value.trim();e.length>1?l(e):(t.innerHTML="",t.classList.add("hidden"))},300),i.value=this.value,o.value||(o.value="")}),m.addEventListener("click",function(e){e.preventDefault();const r=a.value.trim();r.length>1&&l(r)});function l(e){const r=`/api/company-search?query=${encodeURIComponent(e)}`;p(),fetch(r).then(n=>{if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);return n.json()}).then(n=>{Array.isArray(n)?u(n):u([])}).catch(n=>{console.error("Error:",n),t.innerHTML='<p class="p-2 text-red-500">検索中にエラーが発生しました。: '+n.message+"</p>"}).finally(()=>{h()})}function p(){const e=document.createElement("div");e.id="search-loader",e.className="text-center p-3",e.innerHTML='<div class="inline-block animate-spin rounded-full h-6 w-6 border-t-2 border-b-2 border-cyan-500"></div>',t.innerHTML="",t.appendChild(e),t.classList.remove("hidden")}function h(){const e=document.getElementById("search-loader");e&&e.remove()}function u(e){if(t.innerHTML="",e.length===0)t.innerHTML='<p class="p-2">検索結果がありません。</p>';else{const r=document.createElement("ul");r.className="divide-y divide-gray-200",e.forEach(n=>{const c=document.createElement("li");c.className="p-2 hover:bg-gray-100 cursor-pointer",c.innerHTML=`
                    <div class="font-medium">${n.company_name}</div>
                    <div class="text-xs text-gray-500">${n.location}</div>
                `,c.addEventListener("click",()=>{a.value=n.company_name,o.value=n.corporate_number,i.value=n.company_name,t.classList.add("hidden")}),r.appendChild(c)}),t.appendChild(r)}t.classList.remove("hidden")}a.addEventListener("focus",function(){this.select()}),document.addEventListener("click",function(e){!t.contains(e.target)&&e.target!==a&&t.classList.add("hidden")})});
