document.addEventListener("DOMContentLoaded",function(){const i=document.getElementById("company-search"),n=document.getElementById("search-results"),a=document.getElementById("search-button");let r;i.addEventListener("input",function(){clearTimeout(r),r=setTimeout(()=>{const e=this.value.trim();e.length>1?s(e):(n.innerHTML="",n.classList.add("hidden"))},300)}),a.addEventListener("click",function(e){e.preventDefault();const o=i.value.trim();o.length>1&&s(o)}),console.log("appUrl:",window.appUrl);function s(e){const o=`${window.appUrl}/companies/search?query=${encodeURIComponent(e)}`;console.log("Fetching from:",o),fetch(o).then(t=>{if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);return t.json()}).then(t=>{d(t)}).catch(t=>{console.error("Error:",t),n.innerHTML='<p class="p-2 text-red-500">検索中にエラーが発生しました。</p>',n.classList.remove("hidden")})}function d(e){if(n.innerHTML="",e.length===0)n.innerHTML='<p class="p-2">検索結果がありません。</p>';else{const o=document.createElement("ul");o.className="divide-y divide-gray-200",e.forEach(t=>{const c=document.createElement("li");c.className="p-2 hover:bg-gray-100 cursor-pointer",c.innerHTML=`
                    <div class="font-medium">${t.company_name}</div>
                    <div class="text-xs text-gray-500">${t.location}</div>
                `,c.addEventListener("click",()=>{window.location.href=`${window.appUrl}/companies/${t.corporate_number}`}),o.appendChild(c)}),n.appendChild(o)}n.classList.remove("hidden")}document.addEventListener("click",function(e){!n.contains(e.target)&&e.target!==i&&n.classList.add("hidden")})});
