document.addEventListener("DOMContentLoaded",function(){const i=document.getElementById("company-input"),n=document.getElementById("input-results"),c=document.getElementById("corporate_number"),o=document.getElementById("company_name"),s=document.getElementById("input-button");s.disabled=!1;let r;i.addEventListener("input",function(){clearTimeout(r),r=setTimeout(()=>{const e=this.value.trim();e.length>1?l(e):(n.innerHTML="",n.classList.add("hidden"))},300),o.value=this.value,c.value||(c.value="")}),s.addEventListener("click",function(e){e.preventDefault();const d=i.value.trim();d.length>1&&l(d)});function l(e){const d=`${window.appUrl}/companies/search?query=${encodeURIComponent(e)}`;u(),fetch(d).then(t=>t.json()).then(t=>{p(t)}).catch(t=>{console.error("Error:",t),n.innerHTML='<p class="p-2 text-red-500">検索中にエラーが発生しました。</p>'}).finally(()=>{m()})}function u(){const e=document.createElement("div");e.id="search-loader",e.className="text-center p-3",e.innerHTML='<div class="inline-block animate-spin rounded-full h-6 w-6 border-t-2 border-b-2 border-cyan-500"></div>',n.innerHTML="",n.appendChild(e),n.classList.remove("hidden")}function m(){const e=document.getElementById("search-loader");e&&e.remove()}function p(e){if(n.innerHTML="",e.length===0)n.innerHTML='<p class="p-2">検索結果がありません。</p>';else{const d=document.createElement("ul");d.className="divide-y divide-gray-200",e.forEach(t=>{const a=document.createElement("li");a.className="p-2 hover:bg-gray-100 cursor-pointer",a.innerHTML=`
                    <div class="font-medium">${t.company_name}</div>
                    <div class="text-xs text-gray-500">${t.location}</div>
                `,a.addEventListener("click",()=>{i.value=t.company_name,c.value=t.corporate_number,o.value=t.company_name,n.classList.add("hidden")}),d.appendChild(a)}),n.appendChild(d)}n.classList.remove("hidden")}i.addEventListener("focus",function(){this.select()}),document.addEventListener("click",function(e){!n.contains(e.target)&&e.target!==i&&n.classList.add("hidden")})});
