document.addEventListener("DOMContentLoaded",function(){console.log("DOMContentLoaded event fired"),h(),E(),S(),B(),_(),q();for(let e=1;e<=3;e++){const n=document.getElementById(`factor_${e}_detail`),o=document.getElementById(`factor_${e}_detail_count`),r=document.getElementById(`factor_${e}_satisfaction_reason`),c=document.getElementById(`factor_${e}_satisfaction_reason_count`);n&&o&&n.addEventListener("input",function(){o.textContent=this.value.length}),r&&c&&r.addEventListener("input",function(){c.textContent=this.value.length})}});function h(){if(!document.getElementById("job-categories")){console.error("job-categories element not found");return}}function E(){for(let e=2;e<=3;e++)v(e);b(),L(),I()}function v(e){const n=document.querySelectorAll(`input[name="deciding_factor_${e}"]`),o=document.getElementById(`factor_${e}_detail`),r=document.querySelectorAll(`input[name="factor_${e}_satisfaction"]`),c=document.getElementById(`factor_${e}_satisfaction_reason`);n.forEach(s=>{s.addEventListener("change",function(){const t=document.querySelector(`input[name="deciding_factor_${e}"]:checked`)!==null;console.log(`Factor ${e} selected: ${t}`),o.required=t,r.forEach(a=>a.required=t),c.required=t})})}function b(){document.querySelectorAll(".deciding-factor").forEach(n=>{n.addEventListener("change",function(){if(document.querySelectorAll(`[name="${this.name}"] + .factor-label`).forEach(o=>{o.classList.remove("bg-cyan-500","text-white","border-cyan-500"),o.classList.add("bg-white","hover:bg-gray-100","text-gray-700","border-gray-300")}),this.checked){const o=this.nextElementSibling;o.classList.remove("bg-white","hover:bg-gray-100","text-gray-700","border-gray-300"),o.classList.add("bg-cyan-500","text-white","border-cyan-500")}})})}function L(){const e=document.getElementById("add-factor-button"),n=document.querySelectorAll("#deciding-factors > div");let o=1;e.addEventListener("click",function(){o<3&&(o++,n[o-1].classList.remove("hidden"),o===3&&(e.style.display="none"))})}function I(){const e=document.querySelectorAll(".deciding-factor"),n={};e.forEach(r=>{const c=r.getAttribute("name");n[c]||(n[c]=[]),n[c].push(r)});function o(){const r=new Set;Object.values(n).forEach(c=>{c.forEach(s=>{s.checked&&r.add(s.value)})}),Object.values(n).forEach(c=>{c.forEach(s=>{const t=s.nextElementSibling;r.has(s.value)&&!s.checked?(s.disabled=!0,t.classList.add("opacity-50","cursor-not-allowed")):(s.disabled=!1,t.classList.remove("opacity-50","cursor-not-allowed"))})})}e.forEach(r=>{r.addEventListener("change",o)}),o()}function S(){document.querySelectorAll(".flex.items-center").forEach(n=>{const o=n.querySelectorAll("svg"),r=n.querySelectorAll('input[type="radio"]');function c(t){o.forEach((a,l)=>{l<=t?(a.classList.add("text-cyan-500"),a.classList.remove("text-gray-300")):(a.classList.remove("text-cyan-500"),a.classList.add("text-gray-300"))})}r.forEach((t,a)=>{t.addEventListener("change",()=>{c(a)})}),o.forEach((t,a)=>{t.addEventListener("mouseover",()=>{c(a)}),t.addEventListener("mouseout",()=>{const l=n.querySelector('input[type="radio"]:checked');c(l?Array.from(r).indexOf(l):-1)}),t.addEventListener("click",()=>{r[a].checked=!0,c(a)})});const s=n.querySelector('input[type="radio"]:checked');s&&c(Array.from(r).indexOf(s))})}function B(){const e=document.getElementById("next-button"),n=document.getElementById("back-button");document.getElementById("submit-button");const o=document.getElementById("section-1"),r=document.getElementById("section-2"),c=document.getElementById("progress-bar"),s=document.getElementById("progress-bar-2"),t=document.getElementById("step-2");e.addEventListener("click",function(l){l.preventDefault(),a()?(o.classList.add("hidden"),r.classList.remove("hidden"),c.style.width="100%",s.style.width="30%",t.classList.remove("bg-white","border-2","border-gray-300"),t.classList.add("bg-cyan-500"),t.querySelector("span").classList.remove("text-gray-500"),t.querySelector("span").classList.add("text-white"),window.scrollTo({top:0,behavior:"smooth"})):console.log("フォームのバリデーションに失敗しました")}),n.addEventListener("click",function(){r.classList.add("hidden"),o.classList.remove("hidden"),c.style.width="30%",s.style.width="0%",t.classList.add("bg-white","border-2","border-gray-300"),t.classList.remove("bg-cyan-500"),t.querySelector("span").classList.add("text-gray-500"),t.querySelector("span").classList.remove("text-white")});function a(){const l=o.querySelectorAll("input[required], select[required], textarea[required]");let f=!0;l.forEach(u=>{let i;if(u.type==="radio"){i=document.getElementById(`${u.name}-error`);const g=o.querySelectorAll(`input[name="${u.name}"]`);Array.from(g).some(p=>p.checked)?(g.forEach(p=>p.classList.remove("error")),i&&(i.style.display="none")):(f=!1,g.forEach(p=>p.classList.add("error")),i&&(i.textContent="このフィールドは必須です。",i.style.display="block"))}else u.type==="select-one"?(i=document.getElementById(`${u.id}-error`),u.value===""?(f=!1,u.classList.add("error"),i&&(i.textContent="このフィールドは必須です。",i.style.display="block")):(u.classList.remove("error"),i&&(i.style.display="none"))):u.value.trim()?(u.classList.remove("error"),i&&(i.style.display="none")):(i=document.getElementById(`${u.id}-error`),f=!1,u.classList.add("error"),i&&(i.textContent="このフィールドは必須です。",i.style.display="block"))});const d=document.querySelector('input[name="status"]:checked'),y=document.getElementById("end_year"),m=document.getElementById("end_year-error");return d&&d.value==="退職済み"&&(!y.value||y.value==="")?(f=!1,y.classList.add("error"),m&&(m.textContent="退職年を選択してください。",m.style.display="block")):(y.classList.remove("error"),m&&(m.style.display="none")),f}}function _(){const e=document.querySelectorAll('input[name="status"]'),n=document.getElementById("start_year"),o=document.getElementById("end_year");n.addEventListener("change",function(){r()});function r(){const s=parseInt(n.value),t=new Date().getFullYear();o.innerHTML='<option value="" selected disabled>退職年</option>';for(let a=s;a<=t;a++){const l=document.createElement("option");l.value=a,l.textContent=a+"年",o.appendChild(l)}c()}function c(){var l;const s=document.getElementById("end_year");if(!s)return;const t=((l=document.querySelector('input[name="status"]:checked'))==null?void 0:l.value)==="在籍中";s.style.display=t?"none":"inline-block",s.disabled=t,s.required=!t,t&&(s.value="");const a=document.getElementById("end_year-error");a&&(a.style.display="none")}e.forEach(s=>{s.addEventListener("change",c)}),r(),c()}function q(){const e=document.getElementById("company-input"),n=document.getElementById("input-results"),o=document.getElementById("input-button"),r=document.getElementById("company_name"),c=document.getElementById("corporate_number");let s;e.addEventListener("input",t),o.addEventListener("click",a),document.addEventListener("click",function(d){!e.contains(d.target)&&!n.contains(d.target)&&n.classList.add("hidden")});function t(){clearTimeout(s),s=setTimeout(()=>{const d=this.value.trim();d.length>=2?a(d):n.classList.add("hidden")},300)}function a(d){typeof d!="string"&&(d=e.value.trim()),d.length>=2&&fetch(`/api/companies/search?term=${encodeURIComponent(d)}`).then(y=>y.json()).then(l)}function l(d){n.innerHTML="",d.forEach(y=>{const m=document.createElement("div");m.textContent=y.company_name,m.classList.add("p-2","hover:bg-gray-100","cursor-pointer"),m.addEventListener("click",()=>f(y)),n.appendChild(m)}),n.classList.remove("hidden")}function f(d){e.value=d.company_name,r.value=d.company_name,c.value=d.corporate_number,n.classList.add("hidden"),e.setAttribute("readonly",!0),o.setAttribute("disabled",!0)}}
