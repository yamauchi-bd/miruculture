document.addEventListener("DOMContentLoaded",function(){const r=document.getElementById("company-input"),t=document.getElementById("input-results"),s=document.getElementById("corporate_number"),d=document.getElementById("company_name"),l=document.getElementById("input-button");l.disabled=!1;let u;r.addEventListener("input",function(){clearTimeout(u),u=setTimeout(()=>{const e=this.value.trim();e.length>1?m(e):(t.innerHTML="",t.classList.add("hidden"))},300),d.value=this.value,s.value||(s.value="")}),l.addEventListener("click",function(e){e.preventDefault();const i=r.value.trim();i.length>1&&m(i)});function m(e){const i=`/api/company-search?query=${encodeURIComponent(e)}`;h(),fetch(i).then(n=>{if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);return n.json()}).then(n=>{if(console.log("API Response:",n),Array.isArray(n))a(n);else if(n["hojin-infos"]&&Array.isArray(n["hojin-infos"])){const o=n["hojin-infos"].map(c=>({corporate_number:c.corporate_number,company_name:c.name,location:c.location}));a(o)}else a([])}).catch(n=>{console.error("Error:",n),t.innerHTML='<p class="p-2 text-red-500">検索中にエラーが発生しました。: '+n.message+"</p>"}).finally(()=>{p()})}function h(){const e=document.createElement("div");e.id="search-loader",e.className="text-center p-3",e.innerHTML='<div class="inline-block animate-spin rounded-full h-6 w-6 border-t-2 border-b-2 border-cyan-500"></div>',t.innerHTML="",t.appendChild(e),t.classList.remove("hidden")}function p(){const e=document.getElementById("search-loader");e&&e.remove()}function a(e){if(t.innerHTML="",!Array.isArray(e)||e.length===0)t.innerHTML='<p class="p-2">検索結果がありません。</p>';else{const i=document.createElement("ul");i.className="divide-y divide-gray-200",e.forEach(n=>{const o=document.createElement("li");o.className="p-2 hover:bg-gray-100 cursor-pointer",o.innerHTML=`
                    <div class="font-medium">${n.company_name}</div>
                    <div class="text-xs text-gray-500">${n.location}</div>
                `,o.addEventListener("click",()=>{r.value=n.company_name,s.value=n.corporate_number,d.value=n.company_name,t.classList.add("hidden")}),i.appendChild(o)}),t.appendChild(i)}t.classList.remove("hidden")}r.addEventListener("focus",function(){this.select()}),document.addEventListener("click",function(e){!t.contains(e.target)&&e.target!==r&&t.classList.add("hidden")})});
