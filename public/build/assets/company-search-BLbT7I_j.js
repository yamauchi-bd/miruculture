document.addEventListener("DOMContentLoaded",function(){const i=[document.getElementById("company-search"),document.getElementById("company-search-mobile")],n=[document.getElementById("search-results"),document.getElementById("search-results-mobile")];document.getElementById("search-button"),document.getElementById("search-button-mobile");let d,c={};i.forEach((t,e)=>{t&&t.addEventListener("input",function(){clearTimeout(d),d=setTimeout(()=>{const r=this.value.trim();r.length>1?m(r,e):(n[e].innerHTML="",n[e].classList.add("hidden"))},500)})});function m(t,e){if(c[t]){l(c[t],e);return}const r=`${window.appUrl}/companies/search?query=${encodeURIComponent(t)}`;u(e),fetch(r).then(o=>{if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);return o.json()}).then(o=>{c[t]=o,l(o,e)}).catch(o=>{console.error("Error:",o),n[e].innerHTML='<p class="p-2 text-red-500">検索中にエラーが発生しました。</p>',n[e].classList.remove("hidden")}).finally(()=>{h(e)})}function l(t,e){if(n[e].innerHTML="",t.length===0)n[e].innerHTML='<p class="p-2">検索結果がありません。</p>';else{const r=document.createElement("p");r.className="p-2 text-sm text-gray-600",r.textContent=`${t.length}件の結果`,n[e].appendChild(r);const o=document.createElement("ul");o.className="divide-y divide-gray-200",t.forEach(a=>{const s=document.createElement("li");s.className="p-1 hover:bg-gray-100 cursor-pointer transition duration-150 ease-in-out",s.innerHTML=`
                    <div class="text-sm font-medium text-gray-800">${a.company_name}</div>
                    <div class="text-xs text-gray-500">${a.location}</div>
                `,s.addEventListener("click",()=>{window.location.href=`${window.appUrl}/companies/${a.corporate_number}`}),o.appendChild(s)}),n[e].appendChild(o)}n[e].classList.remove("hidden")}function u(t){const e=document.createElement("div");e.id=`search-loader-${t}`,e.className="text-center p-3",e.innerHTML='<div class="inline-block animate-spin rounded-full h-6 w-6 border-t-2 border-b-2 border-cyan-500"></div>',n[t].innerHTML="",n[t].appendChild(e),n[t].classList.remove("hidden")}function h(t){const e=document.getElementById(`search-loader-${t}`);e&&e.remove()}document.addEventListener("click",function(t){n.forEach((e,r)=>{!e.contains(t.target)&&t.target!==i[r]&&e.classList.add("hidden")})})});
