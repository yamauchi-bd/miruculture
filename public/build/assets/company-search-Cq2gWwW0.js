document.addEventListener("DOMContentLoaded",function(){const i=[document.getElementById("company-search"),document.getElementById("company-search-mobile")],o=[document.getElementById("search-results"),document.getElementById("search-results-mobile")],u=[document.getElementById("search-button"),document.getElementById("search-button-mobile")];let l,c={};i.forEach((t,e)=>{t&&(t.addEventListener("input",function(){clearTimeout(l),l=setTimeout(()=>{const r=this.value.trim();r.length>1?d(r,e):(o[e].innerHTML="",o[e].classList.add("hidden"))},300)}),u[e].addEventListener("click",function(r){r.preventDefault();const n=t.value.trim();n.length>1&&d(n,e)}))});function d(t,e){if(c[t]){m(c[t],e);return}const r=`${window.appUrl}/companies/search?query=${encodeURIComponent(t)}`;h(e),fetch(r).then(n=>{if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);return n.json()}).then(n=>{c[t]=n,m(n,e)}).catch(n=>{console.error("Error:",n),o[e].innerHTML='<p class="p-2 text-red-500">検索中にエラーが発生しました。</p>',o[e].classList.remove("hidden")}).finally(()=>{p(e)})}function m(t,e){if(o[e].innerHTML="",t.length===0)o[e].innerHTML='<p class="p-2">検索結果がありません。</p>';else{const r=document.createElement("p");r.className="p-2 text-sm text-gray-600",r.textContent=`${t.length}件の結果`,o[e].appendChild(r);const n=document.createElement("ul");n.className="divide-y divide-gray-200",t.forEach(a=>{const s=document.createElement("li");s.className="p-1 hover:bg-gray-100 cursor-pointer transition duration-150 ease-in-out",s.innerHTML=`
                    <div class="text-sm font-medium text-gray-800">${a.company_name}</div>
                    <div class="text-xs text-gray-500">${a.location}</div>
                `,s.addEventListener("click",()=>{window.location.href=`${window.appUrl}/companies/${a.corporate_number}`}),n.appendChild(s)}),o[e].appendChild(n)}o[e].classList.remove("hidden")}function h(t){const e=document.createElement("div");e.id=`search-loader-${t}`,e.className="text-center p-3",e.innerHTML='<div class="inline-block animate-spin rounded-full h-6 w-6 border-t-2 border-b-2 border-cyan-500"></div>',o[t].innerHTML="",o[t].appendChild(e),o[t].classList.remove("hidden")}function p(t){const e=document.getElementById(`search-loader-${t}`);e&&e.remove()}document.addEventListener("click",function(t){o.forEach((e,r)=>{!e.contains(t.target)&&t.target!==i[r]&&e.classList.add("hidden")})})});
