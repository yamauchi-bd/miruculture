document.addEventListener("DOMContentLoaded",function(){console.log("Step 1: DOMContentLoaded event fired"),i(),m(),f()});function i(){const s=document.getElementById("job-categories");if(!s){console.error("job-categories element not found");return}const n=JSON.parse(s.dataset.categories),o=document.getElementById("job_category"),a=document.getElementById("job_subcategory");if(!o||!a){console.error("job_category or job_subcategory element not found");return}if(o.value){u(o.value,n);const r=a.dataset.currentSubcategoryId;r&&(a.value=r)}o.addEventListener("change",function(){u(this.value,n)})}function u(s,n){const o=document.getElementById("job_subcategory");o.innerHTML='<option value="">選択してください</option>',s&&n[s]&&n[s].forEach(r=>{const e=document.createElement("option");e.value=r.id,e.textContent=r.name,o.appendChild(e)});const a=o.dataset.currentSubcategoryId;a&&(o.value=a)}function m(){document.querySelector("form").addEventListener("submit",function(n){n.preventDefault(),y()?this.submit():console.log("フォームのバリデーションに失敗しました")})}function y(){const s=document.querySelectorAll("input[required], select[required], textarea[required]");let n=!0;s.forEach(e=>{let t;if(e.type==="radio"){t=document.getElementById(`${e.name}-error`);const c=document.querySelectorAll(`input[name="${e.name}"]`);Array.from(c).some(d=>d.checked)?(c.forEach(d=>d.classList.remove("error")),t&&(t.style.display="none")):(n=!1,c.forEach(d=>d.classList.add("error")),t&&(t.textContent="このフィールドは必須です。",t.style.display="block"))}else e.type==="select-one"?(t=document.getElementById(`${e.id}-error`),e.value===""?(n=!1,e.classList.add("error"),t&&(t.textContent="このフィールドは必須です。",t.style.display="block")):(e.classList.remove("error"),t&&(t.style.display="none"))):e.value.trim()?(e.classList.remove("error"),t&&(t.style.display="none")):(t=document.getElementById(`${e.id}-error`),n=!1,e.classList.add("error"),t&&(t.textContent="このフィールドは必須です。",t.style.display="block"))});const o=document.querySelector('input[name="status"]:checked'),a=document.getElementById("end_year"),r=document.getElementById("end_year-error");return o&&o.value==="退職済み"&&(!a.value||a.value==="")?(n=!1,a.classList.add("error"),r&&(r.textContent="退職年を選択してください。",r.style.display="block")):(a.classList.remove("error"),r&&(r.style.display="none")),n}function f(){const s=document.querySelectorAll('input[name="status"]'),n=document.getElementById("start_year"),o=document.getElementById("end_year");n.addEventListener("change",function(){a()});function a(){const e=parseInt(n.value),t=new Date().getFullYear();o.innerHTML='<option value="" selected disabled>退職年</option>';for(let c=e;c<=t;c++){const l=document.createElement("option");l.value=c,l.textContent=c+"年",o.appendChild(l)}r()}function r(){var l;const e=document.getElementById("end_year");if(!e)return;const t=((l=document.querySelector('input[name="status"]:checked'))==null?void 0:l.value)==="在籍中";e.style.display=t?"none":"inline-block",e.disabled=t,e.required=!t,t&&(e.value="");const c=document.getElementById("end_year-error");c&&(c.style.display="none")}s.forEach(e=>{e.addEventListener("change",r)}),a(),r()}
